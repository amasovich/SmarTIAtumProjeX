# SmarTIAtumProjeX

### Автоматизация без лишних кликов в TIA Portal  (TIA Openness / C# / Excel)

## 📦 Описание проекта

`SmarTIAtumProjeX` — консольное приложение, предназначенное для разработчиков АСУ ТП и инженеров, использующих TIA Portal. Основная цель — автоматизировать процесс создания проектов: от генерации и открытия проекта до вставки устройств и модулей и их параметров, используя данные из Excel-шаблона.

Программа строиться на базе кастомной библиотеки `OpTIAtumLib`, реализующей доступ к TIA Openness API через сервисно-фасадную архитектуру.

Проект развивающийся: в перспективе развитие библиоткеки OpTIAtumLib, разработка функциональности консольного приложения SmarTIAtumProjeX и создание оконного приложения SmarTIAtumStudio.

## ✨ Возможности

- ✅ Импорт данных об оборудовании из Excel-шаблона
- ✅ Автоматическое создание проекта TIA Portal (или открытие существующего)
- ✅ Вставка устройств: PLC, ET200, HMI, SCALANCE, GSD-устройства и др.
- ✅ Вставка модулей (DeviceItem) в соответствующие устройства
- ✅ Создание и подключение подсетей (в разработке)
- ✅ Генерация пустого Excel-шаблона
- ✅ Вывод логов на экран и в файл `SmarTIAtumLog.txt`
- ✅ Отладочные тесты и демонстрационные сценарии в папке `/Test`
- ✅ В перспективе импорт/экспорт данных и программ.

## 📁 Структура проекта

```
SmarTIAtumProjeX/
│
├── OpTIAtumLib/                # Основная библиотека
│   ├── Core/                   # Фасад TIAConnector и интерфейс ITIAConnector
│   ├── Model/                  # Модели: DeviceModel, DeviceClassType
│   ├── Service/                # Реализация логики Openness
│   │   ├── Devices/            # Добавление устройств и модулей
│   │   ├── Projects/           # Создание/открытие проектов
│   │   ├── Subnets/            # Работа с подсетями
│   │   └── TIASession/         # Работа с whitelist и запуск TIA
│   ├── Utility/                # Утилиты
│   │   ├── Device/             # DeviceBrowser, Classifier, Inspector
│   │   └── Logger/             # Логгер
│   └── Properties/             # AssemblyInfo.cs и настройки сборки
│
├── SmarTIAtumProjeX/           # Консольное приложение
│   ├── Controller/             # (зарезервировано под будущую логику)
│   ├── Model/                  # (зарезервировано под данные Excel)
│   ├── Repository/             # (зарезервировано под обработку Excel)
│   ├── Service/                # (зарезервировано под бизнес-логику)
│   ├── Test/                   # Тестовые сценарии
│   ├── Utility/                # Поведение консольного окна
│   └── Program.cs              # Главная точка входа
```

## 🔧 Зависимости

- TIA Portal v18 (с установленным Siemens Openness API)
- .NET Framework 4.7.2 или .NET 6+
- Excel-файл шаблона конфигурации оборудования
- Whitelist-запись в реестре для запуска приложения

## 🚀 Быстрый старт

1. Добавьте приложение в whitelist Openness (см. раздел ниже);
2. Убедитесь, что Excel-шаблон находится в нужной директории (или сгенерируйте новый);
3. Соберите проект и запустите `SmarTIAtumProjeX.exe`;
4. Результат будет виден в TIA Portal и логах.

## 🧠 Основные классы и сервисы библиотеки OpTIAtumLib

| Компонент          | Назначение                                   |
| ------------------ | -------------------------------------------- |
| `TIAConnector`     | Фасад доступа к TIA Instance и сервисам      |
| `DeviceService`    | Добавление устройств и модулей (включая GSD) |
| `ProjectService`   | Создание и открытие проектов                 |
| `SubnetService`    | Работа с подсетями (создание, подключение)   |
| `SessionService`   | Запуск TIA Portal, управление whitelist      |
| `DeviceModel`      | Модель устройства с типами и атрибутами      |
| `DeviceClassifier` | Определение класса устройства по OrderNumber |
| `DeviceBrowser`    | Получение списка устройств из проекта        |
| `DeviceInspector`  | Вывод всех свойств устройств (отладка)       |
| `Logger`           | Вывод и сохранение логов                     |

## 📜 Примеры использования

```csharp
TIAConnector tia = new TIAConnector();
tia.SessionService.CreateTIAInstance(true);
tia.ProjectService.CreateProject("C:\TIA_Projects", "NewProject");
tia.DeviceService.AddDeviceToProject(new DeviceModel {
    DeviceName = "PLC_1",
    OrderNumber = "6ES7 517-3FP00-0AB0",
    FirmwareVersion = "V3.0",
    PositionNumber = 0
});
```

## 🛡️ Whitelist

Программа автоматически регистрирует себя в whitelist при первом запуске через метод `SessionService.CreateTIAInstance(true)`, поэтому ручные действия не требуются.

> ⚠ Если вы запускаете проект из Visual Studio впервые — рекомендуется запускать его от имени администратора.csharp
> SessionService.SetWhiteList("SmarTIAtumProjeX", Application.ExecutablePath);



## 📄 Шаблон Excel (в разработке)


Будущий функционал работы с Excel-шаблоном предполагает реализацию полного цикла: от генерации пустого файла до импорта пользовательской конфигурации оборудования.

🔧 **Планируемые возможности:**

- 📁 Автоматическая **генерация шаблона Excel** с предустановленной структурой;
- 🧩 Колонки в шаблоне:
  - Тип устройства (PLC, HMI, GSD...)
  - OrderNumber или GSD-идентификатор
  - Версия прошивки
  - Имя станции и устройства
  - Позиция модуля
  - Идентификаторы подсети
  - Праметры устройств
  - и др.
- 📤 Поддержка пакетной генерации проекта на основе списка строк из Excel;
- 📥 Валидация входных данных с информативными ошибками;
- 📌 Возможность ручного заполнения шаблона и повторного использования;
- 🔁 В перспективе — двусторонний импорт/экспорт данных и программ.

## 📂 Папка /Test

Содержит:
- `TestRunner` — комплексный сценарий генерации конфигурации;
- `TestRunAddScanDevice` — добавление GSD-устройств;
- `TestDeviceBrowse` — просмотр всех устройств в проекте;
- `DeviceClassifierTest` — проверка распознавания типа по OrderNumber.

## 📚 Документация

- [TIA Openness Manual](docs/TIAPortalOpennessManual_en-US.pdf)
- [Siemens Programming Guideline](docs/SimaticProgrammingGuideline1200_1500_ru-RU.pdf)

## ✍️ Авторы

- Разработчик библиотеки и архитектуры проекта Владимир Березняк, инженер-программист ПЛК (IEC 61131-3, ST), изучаю Java, ООП, алгоритмы, базы данных и CI/CD. Разрабатываю инструменты автоматизации для TIA Portal на C# с Openness API. Ценю структуру, надёжность и инженерный подход в коде.

## 📞 Контакты

**ООО "Комитас"**  
📍 Россия, 125212, г. Москва, Головинское шоссе, д. 5, к. 1, офис 10015/1  
📞 +7 (800) 505-50-20, +7 (499) 551-55-77  
✉ info6@comitas.ru  
🌐 [www.comitas.ru](https://www.comitas.ru)

**Разработчик:** Владимир Березняк, инженер-программист АСУ ТП  
📱 +7-910-320-76-92  
📧 v.bereznyak@comitas.ru

## 📌 Лицензия

Проект распространяется на условиях лицензии [Apache License 2.0, January 2004](/LICENSE.txt).

Разработка осуществляется в рамках внутреннего проекта компании **ООО "Комитас"**. Все наименования, конфигурации и примеры приведены исключительно в учебно-прикладочных целях и могут использоваться свободно при соблюдении условий лицензии.

⚠ В случае коммерческого использования, адаптации в промышленных решениях или внедрения в сторонние корпоративные среды — рекомендуется предварительное согласование с разработчиком.